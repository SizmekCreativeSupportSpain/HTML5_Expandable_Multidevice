window.ebO&&ebO.extensionHooks&&ebO.extensionHooks.push(function(adConfig){"use strict";var scriptName="PL_HTML5FullScreenExpandable";var scriptVersion="1.1.0"; var lastModified="2017-03-09";var lastUploaded="2017-03-09"; var templateVersion="2.0.22"; var isDebug=false;var progFormatID=5;
 var adId=adConfig.adId; var rnd=adConfig.rnd; var uid=adConfig.uid; var _self;var ad; var os;var browser;var adFilter={myAd:uid};adConfig.enablePoliteForCS=true; EBG.customFormats=EBG.customFormats||{};EBG.customFormats[uid]=EBG.customFormats[uid]||{};try{if(parent.EBG){parent.EBG.customFormats=parent.EBG.customFormats||{};parent.EBG.customFormats[uid]=EBG.customFormats[uid];}}
catch(e){}
 
var adSelf=null;var MyAd=function(adConfig){EBG.callSuperConstructor(MyAd,this,[adConfig]);};MyAd.prototype={_show:function(){adSelf=this;var shex=EBG.API.Ad.getAdData(uid,"uponShow")>1&&EBG.API.Ad.shouldExpand(uid);_self.defaultCustomFormatVars={mdIsAutoExpand:shex,mdWasAutoExpand:shex,mdParentLevelsToResize:0, mdBackupImgPath:"",mdBannerSizeInheritance:"default", mdMaxBannerWidth:1024,mdMaxBannerHeight:200,mdLockScrollingWhenExpanded:true,mdEnableSDKDefaultCloseButton:false,mdAutoPlayVideo:false,mdHideBannerWhenExpand:false,mdAutoRepositionInterval:0,mdProgEnable:false,mdProgSettingsFolderPath:"//services.serving-sys.com/programmatic/DomainList/",mdEyeDivZIndex:undefined,mdAdBuilder:!!EBG.API.Ad.getAdData(uid,"adBuilder"),mdAutoCollapseTimer:0,mdInteractionsCancelAutoCollapse:false};_self.initCustomVars();var repos=parseInt(_self.mdAutoRepositionInterval,10);if(!isNaN(repos)&&repos>0){EBG.API.Ad.setAdData(uid,{locationPolling:EBG.Initializer._setLocationPolling(repos), forceLocationPolling:true
});} 
if(typeof mraid!=="undefined"){ _self.setDefault("mdHideBannerWhenExpand",true,true); if(!_self.mdEnableSDKDefaultCloseButton){mraid.useCustomClose(true);}} 
var progMan=new _self.ProgrammaticManager(function(result){ EBG.callSuperFunction(MyAd,adSelf,"_show",[adConfig]);});}};var eventSub=new EBG.Events.EventSubscription(EBG.Events.EventNames.CREATE_AD,function(event){EBG.declareClass(MyAd,event.eventData.currentClass);event.eventData.currentClass=MyAd;});eventSub.timing=EBG.Events.EventTiming.BEFORE;eventSub.dispatcherFilters={"_adConfig.rnd":rnd};EBG.eventMgr.subscribeToEvent(eventSub);


function CustomFormat(){_self=this;EBG.API.EventManager.subscribeToEvent(EBG.Events.EventNames.SHOW_AD,_self.handlers.handleBeforeShowAd,EBG.Events.EventTiming.BEFORE,adFilter);}

CustomFormat.prototype={isDebug:isDebug, defaultCustomFormatVars:undefined,isPolite:undefined,wasPolite:undefined,repositionInterval:undefined,displayWin:undefined,subs:undefined,ebDiv:undefined,panels:undefined,defaultPanel:undefined,defaultPanelName:undefined,iframe:undefined,bannerDiv:undefined,subscribedRSO:undefined,CCs:undefined,banner1x1:undefined,capturedEyeDiv:null,pageWin:undefined,iphonePlusForceHeight:null,publisherDiv:undefined,panelDiv:undefined,panelIFrame:undefined, pm:null,stylesheetOnExpand:{}, stylesheetOnCollapse:{}, stylesheetOnLoad:undefined,


handlers:{handleBeforeShowAd:function(){return _self._handleBeforeShowAd.apply(this,arguments);},handleAfterShowAd:function(){return _self._handleAfterShowAd.apply(this,arguments);},handleCounterInteraction:function(){return _self._handleCounterInteraction.apply(this,arguments);},handlePreExpand:function(){return _self._handlePreExpand.apply(this,arguments);},handleBeforeExpand:function(){return _self._handleBeforeExpand.apply(this,arguments);},handleAfterExpand:function(){return _self._handleAfterExpand.apply(this,arguments);},handleBeforeCollapse:function(){return _self._handleBeforeCollapse.apply(this,arguments);},handleBeforeAddCreatives:function(){return _self._handleBeforeAddCreatives.apply(this,arguments);},handleAfterAddCreatives:function(){return _self._handleAfterAddCreatives.apply(this,arguments);},handleOntimePageResize:function(){return _self._handleOntimePageResize.apply(this,arguments);},handleOntimePageScroll:function(){return _self._handleOntimePageScroll.apply(this,arguments);},handleOntimeOrientation:function(){return _self._handleOntimeOrientation.apply(this,arguments);},handleCreativeContainerReady:function(){return _self._handleCreativeContainerReady.apply(this,arguments);}, handleAfterCollapse:function(){return _self._handleAfterCollapse.apply(this,arguments);},handleBeforeAdUnload:function(){return _self._handleBeforeAdUnload.apply(this,arguments);}, handleMessageReceived:function(){return _self._handleMessageReceived.apply(this,arguments);}
},_handleBeforeShowAd:function(event){_self.log("_handleBeforeShowAd: isDefaultImage="+event.eventData.isDefaultImage+", dlm="+EBG.API.Ad.getAdData(uid,"dlm")+", uponShow="+EBG.API.Ad.getAdData(uid,"uponShow")); if(event.eventData.isDefaultImage)return; ad=event.dispatcher;os=EBG.API.os;browser=EBG.API.browser;_self.isPolite=_self.wasPolite=EBG.API.Ad.getAdData(uid,"dlm")===1;_self.repositionInterval=undefined;_self.displayWin=EBG.API.Adaptor.getDisplayWin();_self.displayWin.gEbPIT=_self.displayWin.gEbPIT||{};_self.pageWin=EBG.API.Adaptor.getPageWin();_self.subs=_self.displayWin.gEbPIT.subscriptions=_self.displayWin.gEbPIT.subscriptions||{};EBG.API.EventManager.subscribeToEvent(EBG.Events.EventNames.SHOW_AD,_self.handlers.handleAfterShowAd,EBG.Events.EventTiming.AFTER,adFilter);EBG.API.EventManager.subscribeToEvent(EBG.Events.EventNames.ADD_CREATIVES,_self.handlers.handleBeforeAddCreatives,EBG.Events.EventTiming.BEFORE,adFilter);EBG.API.EventManager.subscribeToEvent(EBG.Events.EventNames.ADD_CREATIVES,_self.handlers.handleAfterAddCreatives,EBG.Events.EventTiming.AFTER,adFilter);
EBG.API.EventManager.subscribeToEvent(EBG.EBMessage.EXPAND,_self.handlers.handlePreExpand,EBG.Events.EventTiming.BEFORE,adFilter);if(_self.mdInteractionsCancelAutoCollapse){EBG.API.EventManager.subscribeToEvent(EBG.Events.EventNames.HANDLE_COUNTER_INTERACTION,_self.handlers.handleCounterInteraction,EBG.Events.EventTiming.BEFORE);} 
EBG.API.EventManager.subscribeToEvent(EBG.Events.EventNames.EXPAND,_self.handlers.handleBeforeExpand,EBG.Events.EventTiming.BEFORE,adFilter);EBG.API.EventManager.subscribeToEvent(EBG.Events.EventNames.EXPAND,_self.handlers.handleAfterExpand,EBG.Events.EventTiming.AFTER,adFilter);EBG.API.EventManager.subscribeToEvent(EBG.Events.EventNames.COLLAPSE,_self.handlers.handleBeforeCollapse,EBG.Events.EventTiming.BEFORE,adFilter);EBG.API.EventManager.subscribeToEvent(EBG.Events.EventNames.CREATIVE_CONTAINER_READY,_self.handlers.handleCreativeContainerReady,EBG.Events.EventTiming.ONTIME,adFilter); EBG.API.EventManager.subscribeToEvent(EBG.Events.EventNames.COLLAPSE,_self.handlers.handleAfterCollapse,EBG.Events.EventTiming.AFTER,adFilter);EBG.API.EventManager.subscribeToEvent(EBG.Events.EventNames.AD_UNLOAD,_self.handlers.handleBeforeAdUnload,EBG.Events.EventTiming.BEFORE); _self.addWindowListener("message","handleMessageReceived",_self.handlers["handleMessageReceived"]); if(EBG.adaptor.isSafeFrame()){ for(var key in _self.messageHandlers){if(!_self.messageHandlers.hasOwnProperty(key))continue; EBG.pm.bind(key,_self.handlers["handleMessageReceived"],_self,_self.displayWin);}}
_self.ebDiv=EBG.API.Ad.getPlaceholder(uid);_self.panels=EBG.API.Ad.getAdData(uid,"panels");if(_self.panels){for(var pan in _self.panels){if(_self.panels.hasOwnProperty(pan)){_self.defaultPanelName=pan;break;}}}
_self.mdBannerSizeInheritance=_self.mdBannerSizeInheritance==="publisherContainerSize"?3:(_self.mdBannerSizeInheritance==="browserWidth"?2:1);_self.setDefault("mdBannerSizeInheritance",_self.mdBannerSizeInheritance,true);if(!_self.isPolite){_self._subscribeToResizeScrollOrientation("_handleBeforeShowAd:not polite");}},_handleAfterShowAd:function(event){_self.log("_handleAfterShowAd: isDefaultImage="+event.eventData.isDefaultImage+", dlm="+EBG.API.Ad.getAdData(uid,"dlm")+", uponShow="+EBG.API.Ad.getAdData(uid,"uponShow")); if(event.eventData.isDefaultImage&&_self.mdBackupImgPath!==""){var backupImg=EBG.API.Ad.getAdData(uid,"assets")[_self.mdBackupImgPath];if(!backupImg)return;_self.showFullSizedBackupImage(); return;}
if(!_self.wasPolite){_self.iframe=EBG.API.Banner.getElements(uid).banner;_self.bannerDiv=EBG.API.Banner.getElements(uid).bannerDiv; _self._onloadInjectCSSandJS(event);
} 
if(typeof mraid!=="undefined"){ if(_self.mdBannerSizeInheritance===1){if(os.ios||(_self.getViewPortWidth()>adConfig.width&&_self.bannerDiv.getBoundingClientRect().left===0)){EBG.API.Adaptor.setStyle(_self.bannerDiv,{position:"absolute",left:EBG.px(Math.floor((_self.getViewPortWidth()-adConfig.width)/2))});}}} 
if(_self.mdBannerSizeInheritance!==1){if(_self.mdBannerSizeInheritance===3){_self.publisherDiv=_self.ebDiv.parentNode;_self.publisherDivChangeListener=setInterval(_self.setBannerSize,100);}
_self.setBannerSize();}}, _onloadInjectCSSandJS:function(event){ if(EBG.API.Ad.getCustomVar(uid,"_mdCssOnLoad")){_self.stylesheetOnLoad=_self.addStylesheetToHead(_self.tokenReplace(EBG.API.Ad.getCustomVar(uid,"_mdCssOnLoad"),event.dispatcher));_self.log("Injecting CSS on load; removing on unload? "+EBG.API.Ad.getCustomVar(uid,"_mdCssOnLoadRemoveOnUnload"),EBG.API.Ad.getCustomVar(uid,"_mdCssOnLoad"));}
if(EBG.API.Ad.getCustomVar(uid,"_mdJsOnLoad")){_self.execJS(_self.tokenReplace(EBG.API.Ad.getCustomVar(uid,"_mdJsOnLoad"),event.dispatcher));_self.log("Executing JS on load",EBG.API.Ad.getCustomVar(uid,"_mdJsOnLoad"));}}, _handleCounterInteraction:function(event){
 
var eD=event.eventData;if(eD){var i=eD.interaction;if(i){var id=i.interactionData;if(id){var iT=id.initiationType;var rN=id.reportingName;if(iT&&rN&&iT==="user"&&rN!=="default"&&rN!==EBG.API.Ad.getAdData(uid,"defaultPanelName")){_self.log("Cancelling Collapse timer");EBG.API.Panel.cancelCollapseTimer(uid);}}}}},_handlePreExpand:function(event){ var aCT=parseInt(_self.mdAutoCollapseTimer);if(event&&aCT>0){var eD=event.eventData;var dis=event.dispatcher;var panelName=(eD&&eD.panelName)?eD.panelName:(dis&&dis.panelName)?dis.panelName:null; if(panelName&&panelName.toLowerCase()===_self.defaultPanelName.toLowerCase()){if(!eD)event.eventData={};event.eventData.autoCollapse=aCT;_self.log("_handlePreExpand: setting autoCollapseTimer on default panel to "+aCT);}}
if(_self.mdLockScrollingWhenExpanded){EBG.API.Adaptor.hideScrollBars();}},_handleBeforeExpand:function(event){_self.log("_handleBeforeExpand: panelName="+event.dispatcher.panelName);
_self.panelName=event.dispatcher.panelName; if(_self.mdEyeDivZIndex!==undefined){var iDiv=EBG.API.Adaptor.getEyeDiv();var iDivZ=EBG.API.Adaptor.getStyle(iDiv,"zIndex"); if(_self.capturedEyeDiv===null){_self.capturedEyeDiv=iDivZ;} 
if(iDivZ!==_self.mdEyeDivZIndex){EBG.API.Adaptor.setStyle(iDiv,"zIndex",_self.mdEyeDivZIndex);}}
 
var isDefaultPanelExpanding=event.dispatcher.panelName.toLowerCase()===_self.defaultPanelName.toLowerCase();
 if(EBG.API.Ad.getCustomVar(uid,"_mdCssOnPanelExpand")){var injectOnAnyPanel=[7,8,9,10,11,12].indexOf(EBG.API.Ad.getCustomVar(uid,"_mdCssOnPanelExpandType"))>=0;var injectFirstPanelOnly=[4,5,6,10,11,12].indexOf(EBG.API.Ad.getCustomVar(uid,"_mdCssOnPanelExpandType"))>=0;if((injectOnAnyPanel||isDefaultPanelExpanding)&&(!injectFirstPanelOnly||!EBG.API.Ad.isExpanded(uid))){_self.stylesheetOnExpand[event.dispatcher.panelName.toLowerCase()]=_self.addStylesheetToHead(_self.tokenReplace(EBG.API.Ad.getCustomVar(uid,"_mdCssOnPanelExpand"),event.dispatcher));}}
 
if(EBG.API.Ad.getCustomVar(uid,"_mdJsOnPanelExpand")){var execOnAnyPanel=(EBG.API.Ad.getCustomVar(uid,"_mdJsOnPanelExpandType")===3||EBG.API.Ad.getCustomVar(uid,"_mdJsOnPanelExpandType")===4);var execFirstPanelOnly=(EBG.API.Ad.getCustomVar(uid,"_mdJsOnPanelExpandType")===2||EBG.API.Ad.getCustomVar(uid,"_mdJsOnPanelExpandType")===4);if((execOnAnyPanel||isDefaultPanelExpanding)&&(!execFirstPanelOnly||(!EBG.API.Ad.isExpanded(uid)))){_self.execJS(_self.tokenReplace(EBG.API.Ad.getCustomVar(uid,"_mdJsOnPanelExpand"),event.dispatcher));}}
 
if(typeof mraid!=="undefined"){ if(!_self.mdEnableSDKDefaultCloseButton){mraid.useCustomClose(true);}} 
_self.panelDiv=EBG.API.Adaptor.getElementById(event.eventData.props.panel.id);_self.panelIFrame=EBG.API.Adaptor.getElementById(event.eventData.props.asset.id);},_handleAfterExpand:function(event){_self.log("_handleAfterExpand: panelName="+event.dispatcher.panelName); _self._handleOntimePageResize();if(EBG.API.os.ios){setTimeout(function(){_self._handleOntimePageResize();_self.correctIOSPanelPositioning();},500);}},_handleBeforeCollapse:function(event){_self.log("_handleBeforeCollapse: panelName="+event.dispatcher.panelName); _self.setDefault("mdIsAutoExpand",false,true);if(_self.mdLockScrollingWhenExpanded){EBG.API.Adaptor.restoreScrollBarsState();}
_self.dispatchCustomScriptEvent("showBanner");},_handleAfterCollapse:function(event){_self.log("_handleAfterCollapse: panelName="+event.dispatcher.panelName);
 if(_self.mdEyeDivZIndex!==undefined&&!EBG.API.Ad.isExpanded(uid)&&_self.capturedEyeDiv!==null){var iDiv=EBG.API.Adaptor.getEyeDiv(); if(iDiv){EBG.API.Adaptor.setStyle(iDiv,"zIndex",_self.capturedEyeDiv);} 
_self.capturedEyeDiv=null;} 
var isDefaultPanelCollapsing=event.dispatcher.panelName.toLowerCase()===_self.defaultPanelName.toLowerCase();var injectOnAnyPanel;
 if(EBG.API.Ad.getCustomVar(uid,"_mdCssOnPanelExpand")){injectOnAnyPanel=[7,8,9,10,11,12].indexOf(EBG.API.Ad.getCustomVar(uid,"_mdCssOnPanelExpandType"))>=0;var removeOnCollapse=[2,3,5,6,8,9,11,12].indexOf(EBG.API.Ad.getCustomVar(uid,"_mdCssOnPanelExpandType"))>=0;var removeIfLastPanel=[3,6,9,12].indexOf(EBG.API.Ad.getCustomVar(uid,"_mdCssOnPanelExpandType"))>=0;if((injectOnAnyPanel||isDefaultPanelCollapsing)&&(removeOnCollapse&&(!removeIfLastPanel||!EBG.API.Ad.isExpanded(uid)))){_self.stylesheetOnExpand[event.dispatcher.panelName.toLowerCase()].parentNode.removeChild(_self.stylesheetOnExpand[event.dispatcher.panelName.toLowerCase()]);delete _self.stylesheetOnExpand[event.dispatcher.panelName.toLowerCase()];}}

 
if(!EBG.API.Ad.isExpanded(uid)&&[3,6,9,12].indexOf(EBG.API.Ad.getCustomVar(uid,"_mdCssOnPanelExpandType"))>=0){var i;for(i in _self.stylesheetOnExpand){if(!_self.stylesheetOnExpand.hasOwnProperty(i))continue;_self.stylesheetOnExpand[i].parentNode.removeChild(_self.stylesheetOnExpand[i]);delete _self.stylesheetOnExpand[i];}}
 
if(EBG.API.Ad.getCustomVar(uid,"_mdCssOnPanelCollapse")){injectOnAnyPanel=[3,4].indexOf(EBG.API.Ad.getCustomVar(uid,"_mdCssOnPanelCollapseType"))>=0;var injectLastPanelOnly=[2,4].indexOf(EBG.API.Ad.getCustomVar(uid,"_mdCssOnPanelCollapseType"))>=0;if((injectOnAnyPanel||isDefaultPanelCollapsing)&&(!injectLastPanelOnly||!EBG.API.Ad.isExpanded(uid))){_self.stylesheetOnCollapse[event.dispatcher.panelName.toLowerCase()]=_self.addStylesheetToHead(_self.tokenReplace(EBG.API.Ad.getCustomVar(uid,"_mdCssOnPanelCollapse"),event.dispatcher));}}
 
if(EBG.API.Ad.getCustomVar(uid,"_mdJsOnPanelCollapse")){var execOnAnyPanel=(EBG.API.Ad.getCustomVar(uid,"_mdJsOnPanelCollapseType")===3||EBG.API.Ad.getCustomVar(uid,"_mdJsOnPanelCollapseType")===4);var onLastPanelExpanded=(EBG.API.Ad.getCustomVar(uid,"_mdJsOnPanelCollapseType")===2||EBG.API.Ad.getCustomVar(uid,"_mdJsOnPanelCollapseType")===4);if((execOnAnyPanel||isDefaultPanelCollapsing)&&(!onLastPanelExpanded||(!EBG.API.Ad.isExpanded(uid)))){_self.execJS(_self.tokenReplace(EBG.API.Ad.getCustomVar(uid,"_mdJsOnPanelCollapse"),event.dispatcher));}}}, _handleBeforeAddCreatives:function(event){_self.log("_handleBeforeAddCreatives:"+event.eventData.creativeType+":panelName="+(event.eventData.panelName||"banner"));






if(event.eventData.creativeType===EBG.Events.EventNames.ADD_HTML5_MAIN_CREATIVE){ if(_self.isPolite){_self._subscribeToResizeScrollOrientation("_handleBeforeAddCreatives:banner:was polite");_self.isPolite=false;}}
else if(event.eventData.creativeType===EBG.Events.EventNames.ADD_HTML5_PANEL_CREATIVE){ _self.defaultPanel=ad._panels[_self.defaultPanelName.toLowerCase()];}},_handleAfterAddCreatives:function(event){_self.log("_handleAfterAddCreatives:"+event.eventData.creativeType+":panelName="+(event.eventData.panelName||"banner"));},_subscribeToResizeScrollOrientation:function(trig){if(!_self.subscribedRSO){
 EBG.API.EventManager.subscribeToEvent(EBG.Events.EventNames.PAGE_RESIZE,_self.handlers.handleOntimePageResize,EBG.Events.EventTiming.ONTIME,adFilter);EBG.API.EventManager.subscribeToEvent(EBG.Events.EventNames.PAGE_SCROLL,_self.handlers.handleOntimePageScroll,EBG.Events.EventTiming.ONTIME,adFilter);EBG.API.EventManager.subscribeToEvent(EBG.Events.EventNames.SCREEN_ORIENTATION,_self.handlers.handleOntimeOrientation,EBG.Events.EventTiming.ONTIME);_self.subscribedRSO=true;_self.log("_subscribeToResizeScrollOrientation:triggered by "+trig);}},_handleMessageReceived:function(event,params){try{var msg=typeof event=="object"&&event.data?JSON.parse(event.data):typeof event=="undefined"&&typeof params=="object"&&params.data&&typeof params.data=="string"?JSON.parse(params.data):typeof event=="undefined"&&typeof params=="object"&&params.data&&params.data.uid?params:{};
if(msg.type&&msg.data&&msg.data.uid&&msg.data.uid===uid&&_self.messageHandlers.hasOwnProperty(msg.type)){_self.log("_handleMessageReceived:"+msg.type,msg);_self.messageHandlers[msg.type](msg);}}
catch(e){_self.log("_handleMessageReceived:catch",e);}},messageHandlers:{addCustomScriptEventListener:function(msg){_self.subs[msg.data.listenerId]=msg.data;},dispatchCustomScriptEvent:function(msg){for(var i in _self.subs){if(!_self.subs[i])continue;var isEventMatch=_self.subs[i].eventName===msg.data.eventName;var isCurrentAd=msg.data.uid===_self.subs[i].uid;var isOutOfAdScope=!isCurrentAd&&!msg.data.interAd;if(!isEventMatch||isOutOfAdScope)continue;if(_self.subs[i].callback){try{_self.subs[i].callback(msg.data);}
catch(e){delete _self.subs[i];}}
else{var listenerIds=[];listenerIds[listenerIds.length]=_self.subs[i].listenerId;msg.data.listenerIds=listenerIds;try{_self.CCs[_self.subs[i].creativeIFrameId]._sendMessage("eventCallback",msg.data);}
catch(error){}}}},removeCustomScriptEventListener:function(msg){delete _self.subs[msg.data.listenerId];},removeAd:function(){_self.removeAd();},setCreativeVersion:function(msg){if(msg.data.creativeVersion)
_self.handleSetCreativeVersion(msg.data);},ebclickthrough:function(msg){ if(os.ios){_self.iphonePlusForceHeight=null;setTimeout(function(){if(_self.getViewPortWidth()===736){_self.iphonePlusForceHeight=337;}
_self._handleOntimePageResize();},1500);}}},_handleOntimePageResize:function(event){if(_self.isOrientationChange){return;}
if(_self.mdAdBuilder)return;_self.setBannerSize();if(typeof mraid!=="undefined"){ EBG.API.Adaptor.setStyle(_self.panelDiv,{top:EBG.px(0),left:EBG.px(0),width:EBG.px(_self.getViewPortWidth()),height:EBG.px(_self.getViewPortHeight())});EBG.API.Adaptor.setStyle(_self.panelIFrame,{width:EBG.px(_self.getViewPortWidth()),height:EBG.px(_self.getViewPortHeight())});}
else{EBG.API.Panel.modify(uid,_self.panelName.toLowerCase(),{top:_self.iphonePlusForceHeight===null?0:_self.getViewPortHeight()-337,left:0,width:_self.getViewPortWidth(),height:_self.iphonePlusForceHeight===null?_self.getViewPortHeight():_self.iphonePlusForceHeight},true);if(_self.iphonePlusForceHeight!==null){_self.iphonePlusForceHeight=null;}
EBG.API.Adaptor.setStyle(_self.panelDiv,{position:"fixed"});if(EBG.API.os.ios){EBG.API.Adaptor.setStyle(_self.panelIFrame,{maxHeight:"100vh"});}}},_handleOntimePageScroll:function(event){
},_handleOrientationChange:function(event){if(EBG.API.os.ios){var isPortrait=_self.pageWin.innerWidth<_self.pageWin.innerHeight;if(isPortrait&&_self.mdBannerSizeInheritance!==1){EBG.API.Adaptor.setStyle(_self.ebDiv,{width:"1px",height:"1px"});EBG.API.Adaptor.setStyle(_self.iframe,{width:"1px",height:"1px"});}
_self.isOrientationChange=true;clearTimeout(_self.orientationTimeout);_self.orientationTimeout=setTimeout(function(){_self.isOrientationChange=false;_self._handleOntimePageResize();_self.correctIOSPanelPositioning();},1000);}
else if(EBG.API.os.android){_self.isOrientationChange=true;clearTimeout(_self.orientationTimeout);_self.orientationTimeout=setTimeout(function(){_self.isOrientationChange=false;_self._handleOntimePageResize();},1000);}},_handleOntimeOrientation:function(event){_self._handleOntimePageResize();},_handleCreativeContainerReady:function(event){_self.log("_handleCreativeContainerReady:"+(event.dispatcher.panelName||"banner")); if(_self.wasPolite&&!event.dispatcher.panelName){_self.iframe=EBG.API.Banner.getElements(uid).banner;_self.bannerDiv=EBG.API.Banner.getElements(uid).bannerDiv;_self._onloadInjectCSSandJS(event); _self.setBannerSize();} 
var ifrmCC=event.dispatcher;_self.CCs=_self.CCs||{};_self.CCs[ifrmCC.iframeId]=ifrmCC;ifrmCC._sendMessage("sendCreativeId",{creativeIFrameId:ifrmCC.iframeId,uid:uid});
 if(!event.dispatcher.panelName){_self.banner1x1=ifrmCC._iframe.width=="1"&&ifrmCC._iframe.height=="1";} 
else if(event.dispatcher.panelName.toLowerCase()===_self.defaultPanelName.toLowerCase()&&_self.banner1x1){ EBG.API.Banner.setViewabilityElem(uid,event.dispatcher._iframe.id);}  
}, _handleBeforeAdUnload:function(event){_self.log("_handleBeforeAdUnload");
 if(EBG.API.Ad.getCustomVar(uid,"_mdCssOnLoad")&&EBG.API.Ad.getCustomVar(uid,"_mdCssOnLoadRemoveOnUnload")){_self.stylesheetOnLoad.parentNode.removeChild(_self.stylesheetOnLoad);}
if(EBG.API.Ad.getCustomVar(uid,"_mdCssOnUnload")){_self.addStylesheetToHead(_self.tokenReplace(EBG.API.Ad.getCustomVar(uid,"_mdCssOnUnload"),event.dispatcher));}
if(EBG.API.Ad.getCustomVar(uid,"_mdJsOnUnload")){_self.execJS(_self.tokenReplace(EBG.API.Ad.getCustomVar(uid,"_mdJsOnUnload"),event.dispatcher));}},


dispatchCustomScriptEvent:function(eventName,params){var paramsData={type:"dispatchCustomScriptEvent",data:params||{}};paramsData.data.uid=uid;paramsData.data.eventName=eventName;_self._handleMessageReceived(undefined,paramsData);},addCustomScriptEventListener:function(eventName,callback,interAd){var data={uid:uid,listenerId:Math.ceil(Math.random()*1000000000),eventName:eventName,interAd:!!(interAd),callback:callback};_self._handleMessageReceived(undefined,{data:data,type:"addCustomScriptEventListener"});return data.listenerId;},removeCustomScriptEventListener:function(listenerId){_self._handleMessageReceived(undefined,{data:{uid:uid,listenerId:listenerId},type:"removeCustomScriptEventListener"});},

initCustomVars:function(){for(var cv in _self.defaultCustomFormatVars){if(!_self.defaultCustomFormatVars.hasOwnProperty(cv))continue;_self.setDefault(cv,_self.defaultCustomFormatVars[cv]);}
_self.setDefaultWithAppend("mdCustomFormatScriptVer",scriptName+","+scriptVersion,"|");},setDefault:function(varName,defaultValue,optional_override){EBG.API.Ad.setCustomVar(uid,varName,defaultValue,!!optional_override);_self[varName]=EBG.API.Ad.getCustomVar(uid,varName);}, setDefaultWithAppend:function(varName,defaultValue,optionalDelimiter){var delim=optionalDelimiter||"";var val=EBG.API.Ad.getCustomVar(uid,varName);
val=typeof val==="string"?(val+delim+defaultValue):defaultValue;_self.setDefault(varName,val,true);},

correctIOSPanelPositioning:function(){_self.pageWin.scrollTo(NaN,0);},getPublisherDivDimension:function(){var width=EBG.API.Adaptor.getStyle(_self.publisherDiv,"width");var height=EBG.API.Adaptor.getStyle(_self.publisherDiv,"height");if(width!==null&&height!==null){width=width.replace(/px/i,"")*1;height=height.replace(/px/i,"")*1;var minimumWidth=adConfig.width;var minimumHeight=adConfig.height;var maximumWidth=_self.mdMaxBannerWidth;var maximumHeight=_self.mdMaxBannerHeight;maximumWidth=maximumWidth===0?width:Math.max(maximumWidth,minimumWidth);maximumHeight=maximumHeight===0?height:Math.max(maximumHeight,minimumHeight);width=Math.min(Math.max(minimumWidth,width),maximumWidth);height=Math.min(Math.max(minimumHeight,height),maximumHeight);return{width:width,height:height};}
else{return{width:adConfig.width,height:adConfig.height};}},setBannerSize:function(){if(_self.mdAdBuilder)return;if(_self.mdBannerSizeInheritance!==1){var width=adConfig.width;var height=adConfig.height;if(_self.mdBannerSizeInheritance===3){var publisherDivDimension=_self.getPublisherDivDimension();width=publisherDivDimension.width;height=publisherDivDimension.height;}
else if(_self.mdBannerSizeInheritance===2){width=_self.getViewPortWidth();if(EBG.isPreview){setTimeout(function(){EBG.API.Adaptor.setStyle(_self.ebDiv.parentNode,{left:"0px"});},50);}}
EBG.API.Adaptor.setStyle(_self.ebDiv,{width:EBG.px(width),height:EBG.px(height)});if(_self.iframe){EBG.API.Adaptor.setStyle(_self.iframe,{width:EBG.px(width),height:EBG.px(height)});var message={adId:adId,type:"resize",width:width,height:height};_self.iframe.contentWindow.postMessage(JSON.stringify(message),"*");}}},getHighestZIndex:function(){return Math.pow(2,31)-1;},updateZIndex:function(){ EBG.API.Adaptor.setStyle(_self.ebDiv,{zIndex:_self.iframe.style.zIndex});},switchToFixedPositioning:function(){EBG.API.Adaptor.setStyle(_self.ebDiv,{left:0,top:0,position:"fixed"});},collapseIFrame:function(){var h=EBG.px(EBG.API.Ad.getAdData(uid,"height")),w=EBG.px(EBG.API.Ad.getAdData(uid,"width"));var clp="rect(0px "+w+" "+h+" 0px)";EBG.API.Adaptor.setStyle(_self.ebDiv,{left:0,top:0,height:h,width:w,clip:clp});},getOffsetTop:function(elem){var boundingRect=elem.getBoundingClientRect();return boundingRect.top;},getOffsetLeft:function(elem){var boundingRect=elem.getBoundingClientRect();return boundingRect.left;},getViewPortHeight:function(){return EBG.API.Adaptor.getViewPortMetrics().Height;},getViewPortWidth:function(){return EBG.API.Adaptor.getViewPortMetrics().Width;},

log:function(){ if(_self.isDebug){var b,a;b=Array.prototype.slice.call(arguments);a=new Date();a=scriptName+" ("+a.getFullYear()+"-"+a.getMonth()+"-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()+"."+a.getMilliseconds()+"): ";b.unshift(a);try{window.console&&console.log&&(console.log.apply?console.log.apply(console,b):console.log(b));}
catch(d){}}},removeAd:function(){EBG.API.Ad.unload(uid);},addWindowListener:function(eventName,handlerIndex,func){ _self.handlers[handlerIndex]=function(){return func.apply(this,arguments);}; if(_self.displayWin.addEventListener)
_self.displayWin.addEventListener(eventName,_self.handlers[handlerIndex],false);else if(_self.displayWin.attachEvent)
_self.displayWin.attachEvent("on"+eventName,_self.handlers[handlerIndex]);},removeWindowListener:function(eventName,handlerIndex,func){ if(_self.displayWin.removeEventListener)
_self.displayWin.removeEventListener(eventName,_self.handlers[handlerIndex],false);else if(_self.displayWin.detachEvent)
_self.displayWin.detachEvent("on"+eventName,_self.handlers[handlerIndex]);delete _self.handlers[handlerIndex];},handleSetCreativeVersion:function(event){ _self.versions["creativeIds"]+=((_self.versions["creativeIds"]!==""?"|":"")+event.creativeId);_self.versions["creativeVers"]+=((_self.versions["creativeVers"]!==""?"|":"")+event.creativeVersion);_self.versions["creativeLastMods"]+=((_self.versions["creativeLastMods"]!==""?"|":"")+event.creativeLastModified);},showFullSizedBackupImage:function(){try{var backupImg=EBG.API.Ad.getAdData(uid,"assets")[_self.mdBackupImgPath];if(!backupImg)return;if(!_self.ebDiv){_self.ebDiv=EBG.API.Ad.getPlaceholder(uid);}
var img=_self.ebDiv.firstChild;var w=img.width=backupImg.width;var h=img.height=backupImg.height;var path=backupImg.dsPath; EBG.API.Adaptor.setStyle(_self.ebDiv,{width:EBG.px(w),height:EBG.px(h)});img.src=EBG.API.Ad.getAdData(uid,"resourcePath")+path;
if(_self.mdParentLevelsToResize>0){setTimeout(function(){_self.resizeBackupImageParentNodes(w,h,_self.mdParentLevelsToResize);},100);}}
catch(e){}},resizeBackupImageParentNodes:function(w,h,nodes){try{var parentNodes=[_self.ebDiv.parentNode,]; for(var n=1;n<nodes;n++){parentNodes[n]=parentNodes[n-1].parentNode;}
var parentMetrics;for(var i=0;i<parentNodes.length;i++){var parentNode=parentNodes[i];if(parentNode){parentMetrics=EBG.API.Adaptor.getElementMetrics(parentNode);if(parentMetrics.width<w){EBG.API.Adaptor.setStyle(parentNode,{minWidth:EBG.px(w)});}
if(parentMetrics.height<h){EBG.API.Adaptor.setStyle(parentNode,{minHeight:EBG.px(h)});}}}}
catch(e){}}, tokenReplace:function(str,panel){var replaced=str.replace(/\%ebDivID\%/g,_self.ebDiv.id);if(panel&&panel.panelName){replaced=replaced.replace(/\%panelIframeID\%/g,panel.iframeId); if(panel._iframe.parentNode&&panel._iframe.parentNode.id)replaced=replaced.replace(/\%panelDivID\%/g,panel._iframe.parentNode.id);}
replaced=replaced.replace(/\%bannerIframeID\%/g,_self.iframe.id);replaced=replaced.replace(/\%bannerDivID\%/g,_self.iframe.parentNode.id);replaced=replaced.replace(/\%defaultPanelName\%/g,_self.defaultPanelName);replaced=replaced.replace(/\%adid\%/g,adId);replaced=replaced.replace(/\%rnd\%/g,rnd);replaced=replaced.replace(/\%uid\%/g,uid);replaced=_self.htmlUnencode(replaced);return replaced;},htmlUnencode:function(str){var elem=document.createElement("div");elem.innerHTML=str;return(elem.innerText||elem.text||elem.textContent);},addStylesheetToHead:function(styleSheetRules){var styleElement=_self.pm.topDoc.createElement('style');styleElement.setAttribute('type','text/css');if(styleElement.styleSheet){styleElement.styleSheet.cssText=styleSheetRules;}
else{styleElement.appendChild(_self.pm.topDoc.createTextNode(styleSheetRules));}
_self.pm.topDoc.getElementsByTagName('head')[0].appendChild(styleElement);return styleElement;},execJS:function(jsToExec){try{_self.pm.topWin.eval(jsToExec);}
catch(err){}}, reportCFVersions:function(){ var saveDebug=_self.isDebug; _self.isDebug=true; var delim="",s="reportCFVersions:uid:"+uid+": ";for(var v in _self.versions){if(_self.versions.hasOwnProperty(v)){s+=(delim+v+": "+_self.versions[v]);delim=", ";}}
_self.log(s);_self.isDebug=saveDebug;},versions:{"scriptVer":scriptVersion,"scriptLastMod":lastModified,"templateVer":templateVersion,"creativeIds":"","creativeVers":"","creativeLastMods":""},


ProgrammaticManager:function(progReadyCallback){_self.pm=this;_self.pm.constructor=function(){_self.pm.readyCallback=progReadyCallback;_self.pm.topWin=_self.pm.getTopWin(window);_self.pm.topDoc=_self.pm.topWin.document;_self.pm.PROGRAMMATIC_SETTINGS_FILENAME="ProgrammaticSettings_"+progFormatID+".json";_self.pm.DEFAULT_PROGRAMMATIC_SETTING_FOLDER="_default_";_self.pm.mdSettingsFolderPath=EBG.API.Ad.getCustomVar(uid,"mdProgSettingsFolderPath");_self.pm.currentFileRequested=null;_self.pm.currentDetectMethod=null;var enabled=EBG.API.Ad.getCustomVar(uid,"mdProgEnable"); _self.pm.isEnabled=function(){return(!!enabled);};if(_self.pm.isEnabled()){_self.pm.getProgrammaticSettings();}
else{_self.pm.beginExperience();}};_self.pm.getProgrammaticSettings=function(){var queries=_self.pm.getQueryVariables();var domainName;
 if(queries&&queries.domain){_self.pm.currentDetectMethod="queries";domainName=queries.domain;}
else{ _self.pm.currentDetectMethod="cookies";domainName=_self.pm.getDomainUsingCookies(_self.pm.topDoc.domain); if(!domainName){var tldLength=_self.pm.knownTLD(_self.pm.topDoc.domain);if(tldLength){ _self.pm.currentDetectMethod="tld";domainName=_self.pm.topDoc.domain;domainName=domainName.substring(Math.max(domainName.lastIndexOf(".",domainName.length-tldLength-1),0)+1);}}} 
if(domainName){ _self.pm.loadSettingsFile(domainName);}
else{ _self.pm.getDomainUsingClientLoad(_self.pm.topDoc.domain);}};_self.pm.getTopWin=function(thisWin){ thisWin=thisWin||window;var topWin;try{ topWin=top.document&&top;}
catch(err){ topWin=_self.pm.getParentestFriendlyWin(thisWin);}
return topWin;};_self.pm.getParentestFriendlyWin=function(curWin,refWin){
var pfWin;try{refWin=refWin||curWin.parent;pfWin=curWin.document&&curWin;if(refWin!==curWin){pfWin=refWin.document&&refWin;if(refWin!==top){pfWin=_self.pm.getParentestFriendlyWin(refWin)||pfWin;}}}
catch(err){if(refWin!==top){pfWin=_self.pm.getParentestFriendlyWin(refWin)||pfWin;}}
return pfWin;};_self.pm.getQueryVariables=function(){var qsv={}; var kv={}; var query=_self.pm.topWin.location.search.substring(1); var vars=query.split("&");for(var i=0;i<vars.length;i++){kv.name=decodeURIComponent(vars[i].substring(0,vars[i].indexOf("=")));kv.value=decodeURIComponent(vars[i].substring(vars[i].indexOf("=")+1));qsv[kv.name]=kv.value;}
return qsv;};_self.pm.loadSettingsFile=function(domain){_self.pm.currentFileRequested=domain;EBG.getDataFromRemoteServer(_self.pm.buildSettingsURL(domain),_self.pm.parseJSON,_self.pm,true);}; _self.pm.knownTLD=function(testDomain){ var knownTLDs=['.com','.net','.mobi','.cci.fr','.fr','.com.au','.es','.co.uk','.de','.com.cn','.it','.be','.fi','.co.il','.co.jp','.ne.jp','.jp','.nl','.me','.com.pl','.pl','.tv','.qc.ca','.ca','.io','.com.vn','.net.vn','.vn','.com.br','.gr','.com.ar','.com.tr','.co.th','.cz','.ch','.dk','.org','.no','.biz','.co.nz','.se','.pt','.com.my','.co','.co.in','.ro','.com.hk','.fm','.com.tw','.com.al','.al','.cc','.web.id','.co.za','.com.mx','.video','.at','.info','.trade','.cl','.sk','.to','.pe','.cn','.us','.in','.lt','.mx','.bg','.eu','.co.id','.com.sg','.gg','.hn','.my','.la','.com.pk','.pk','.com.kw','.guru','.hk','.hr','.lv','.rs','.ee','.com.uy','.asia','.mus.br','.cat','.gov.au','.id','.ru','.gov.uk','.com.cy','.tw','.nu','.online','.ie','.in.th','.hu','.news','.free','.tf','.com.sa','.sa','.lk','.website','.ba','.sc','.com.ph','.ph','.media','.pr','.xyz','.az','.app','.gen.tr','.md','.net.br','.cf','.com.gh','.club','.lu','.com.do','.ws','.co.kr','.eus','.one','.net.au','.social','.si','.am','.pw','.mk','.im','.best','.com.ua','.ua','.lat','.pm','.com.lb','.ae','.dj','.win','.tt'];for(var i=0;i<knownTLDs.length;i++){if(testDomain.substr(-knownTLDs[i].length)===knownTLDs[i])return knownTLDs[i].length;}
return 0;};_self.pm.getDomainUsingCookies=function(testDomain){if(!_self.pm.topDoc||!navigator.cookieEnabled)return false;try{var i=0;var s="_"+uid+"_"+(new Date()).getTime();var p=testDomain.split(".");while(i<(p.length-1)&&_self.pm.topDoc.cookie.indexOf(s+"="+s)===-1){testDomain=p.slice(-1-(++i)).join(".");_self.pm.topDoc.cookie=s+"="+s+";domain="+testDomain+";";}
if(_self.pm.topDoc.cookie.indexOf(s+"="+s)===-1)testDomain=_self.pm.DEFAULT_PROGRAMMATIC_SETTING_FOLDER;try{_self.pm.topDoc.cookie=s+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;domain="+testDomain+";";}
catch(err){}
return testDomain;}
catch(err){return false;}};_self.pm.getDomainUsingClientLoad=function(docDomain,domsToIgnore){var domainAsArray;var domainParts=0;var checkDomain='';var checkURL='';var filesToCheck=[];domsToIgnore=[].concat(domsToIgnore);_self.pm.currentDetectMethod="clientLoad";domainAsArray=docDomain.split(".");while(domainParts<domainAsArray.length-1){checkDomain=domainAsArray.slice(-1-(++domainParts)).join(".");if(domsToIgnore.indexOf(checkDomain)>=0)continue;checkURL=_self.pm.buildSettingsURL(checkDomain);filesToCheck[filesToCheck.length]=checkURL;}
filesToCheck[filesToCheck.length]=_self.pm.buildSettingsURL(_self.pm.DEFAULT_PROGRAMMATIC_SETTING_FOLDER);function loadFile(url){EBG.getDataFromRemoteServer(url,function(result){if(result){_self.pm.parseJSON(result);}
else{if(filesToCheck.length>0){loadFile(filesToCheck.shift());}
else{ _self.pm.beginExperience();}}},this,true);}
loadFile(filesToCheck.shift());};_self.pm.buildSettingsURL=function(domainToBuild){return _self.pm.topDoc.location.protocol+_self.pm.mdSettingsFolderPath+domainToBuild+"/"+_self.pm.PROGRAMMATIC_SETTINGS_FILENAME+"?ord="+uid;};_self.pm.unbuildSettingsURL=function(urlToUnbuild){var pattern=new RegExp(_self.pm.topDoc.location.protocol+_self.pm.mdSettingsFolderPath+"(.*)/"+_self.pm.PROGRAMMATIC_SETTINGS_FILENAME+"\\?ord="+uid);return pattern.exec(urlToUnbuild)[1];};_self.pm.parseJSON=function(response){if(!response){

 if(_self.pm.currentDetectMethod==="tld"){_self.pm.getDomainUsingClientLoad(_self.pm.topDoc.domain,_self.pm.currentFileRequested);return;}
else if(_self.pm.currentFileRequested!==_self.pm.DEFAULT_PROGRAMMATIC_SETTING_FOLDER){_self.pm.loadSettingsFile(_self.pm.DEFAULT_PROGRAMMATIC_SETTING_FOLDER,_self.pm.parseJSON);return;}
else{_self.pm.beginExperience();return;}}
try{
 var responseSettings=JSON.parse(response).programmaticSettings; var queries=_self.pm.getQueryVariables();var programmaticSettings=null;if(queries&&queries.settingType){switch(queries.settingType){case"Folder":if(responseSettings.hasOwnProperty("folder")&&responseSettings.folder.hasOwnProperty(queries.settingDetail)){programmaticSettings=responseSettings.folder[queries.settingDetail];}
break;case"Subdomain":if(responseSettings.hasOwnProperty("subdomain")&&responseSettings.subdomain.hasOwnProperty(queries.settingDetail)){programmaticSettings=responseSettings.subdomain[queries.settingDetail];}
break;case"Global":if(responseSettings.hasOwnProperty("global")){programmaticSettings=responseSettings.global;}
break;}}
else{var setting;if(!programmaticSettings&&responseSettings.folder){var f=responseSettings.folder;for(setting in f){if(!f.hasOwnProperty(setting))continue;if(_self.pm.hasFolder(setting)){programmaticSettings=f[setting];break;}}}
if(!programmaticSettings&&responseSettings.subdomain){var s=responseSettings.subdomain;for(setting in s){if(!s.hasOwnProperty(setting))continue;if(_self.pm.hasSubdomain(setting)){programmaticSettings=s[setting];break;}}}
if(!programmaticSettings&&responseSettings.global){programmaticSettings=responseSettings.global;}} 
if(programmaticSettings)_self.pm.setProgrammaticSettings(programmaticSettings);_self.pm.beginExperience();}
catch(err){ _self.pm.beginExperience();}};_self.pm.hasFolder=function(folderToTest){return(_self.pm.topDoc.location.pathname.indexOf(folderToTest)!==-1);};_self.pm.hasSubdomain=function(subdomainToTest){return(_self.pm.topDoc.location.hostname.indexOf(subdomainToTest)!==-1||_self.pm.topDoc.location.host.indexOf(subdomainToTest)!==-1);};_self.pm.setProgrammaticSettings=function(programmaticSettings){for(var customVar in programmaticSettings){if(!programmaticSettings.hasOwnProperty(customVar))continue;_self.setDefault(customVar,programmaticSettings[customVar],true);}};_self.pm.beginExperience=function(){if(_self.pm.readyCallback)window.setTimeout(_self.pm.readyCallback,1);};_self.pm.constructor();}

};EBG.reportCFV=function(){for(var i in EBG.customFormats){if(EBG.customFormats.hasOwnProperty(i)){for(var x in EBG.customFormats[i]){if(EBG.customFormats[i].hasOwnProperty(x)){try{EBG.customFormats[i][x].reportCFVersions();}
catch(e){}}}}}};EBG.customFormats[uid][scriptName]=new CustomFormat();});